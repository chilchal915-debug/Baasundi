<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Private Chat</title>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}

.header{
  text-align:center;
  padding:18px;
  font-size:22px;
  background:#1f1f1f;
}

#chat{
  flex:1;
  padding:12px;
  overflow-y:auto;
  font-size:18px;
}

#chat p{
  margin:8px 0;
  word-wrap:break-word;
}

.input-box{
  display:flex;
  background:#1f1f1f;
  padding:8px;
}

#msg{
  flex:1;
  padding:14px;
  border:none;
  outline:none;
  font-size:18px;
  border-radius:8px;
}

button{
  margin-left:8px;
  padding:14px 18px;
  border:none;
  background:#ff4d6d;
  color:#fff;
  font-size:18px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">Lucifer ‚ù§Ô∏è Bassu</div>

<div id="chat"></div>

<div class="input-box">
  <input id="msg" placeholder="Type message..." autocomplete="off">
  <button onclick="send()">Send</button>
</div>

<script>
let peer;
let conn;
const HOST_ID = "lucifer-bassu-room";

// page load hote hi keyboard open
window.onload = () => {
  document.getElementById("msg").focus();
};

// Enter key se bhi send ho
document.getElementById("msg").addEventListener("keydown", e=>{
  if(e.key === "Enter") send();
});

// Try to become host
peer = new Peer(HOST_ID);

peer.on("open", () => {
  addMsg("üü¢ Waiting for partner...");
});

// If ID already taken ‚Üí become client
peer.on("error", err => {
  if (err.type === "unavailable-id") {
    peer = new Peer();

    peer.on("open", () => {
      conn = peer.connect(HOST_ID);

      conn.on("open", () => {
        addMsg("üü¢ Connected");
        setup();
      });
    });
  }
});

// Host receives connection
peer.on("connection", c => {
  conn = c;
  addMsg("üü¢ Connected");
  setup();
});

function setup(){
  conn.on("data", msg => {
    addMsg("‚ù§Ô∏è Partner: " + msg);
    focusInput();
  });
}

function send(){
  const input = document.getElementById("msg");

  if(!conn || !conn.open){
    addMsg("‚ö†Ô∏è Not connected yet");
    return;
  }

  const text = input.value.trim();
  if(text === "") return;

  conn.send(text);
  addMsg("You: " + text);
  input.value="";
  focusInput();
}

function addMsg(text){
  const chat = document.getElementById("chat");
  chat.innerHTML += "<p>" + text + "</p>";
  chat.scrollTop = chat.scrollHeight;
}

function focusInput(){
  const input = document.getElementById("msg");
  input.focus();

  // keyboard open hone par bhi last messages dikhen
  setTimeout(()=>{
    document.getElementById("chat").scrollTop =
      document.getElementById("chat").scrollHeight;
  },100);
}
</script>

</body>
</html>
